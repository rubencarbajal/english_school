<!-- Main container with fade-in animation -->
<div class="animate-fade-in max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-20">
  @if (plan) {
  <div class="text-center">
    <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-white">Schedule Your Classes</h1>
    <p class="mt-3 max-w-3xl mx-auto text-lg text-slate-400">
      You've selected the <span class="font-bold text-sky-400">{{ plan.title }}</span>.
      Please select <span class="font-bold text-sky-400">{{ plan.sessions }}</span> available time slots below.
    </p>
    <p class="mt-2 text-lg font-semibold" [ngClass]="remainingSessions() > 0 ? 'text-amber-400' : 'text-emerald-400'">
      {{ remainingSessions() }} sessions remaining to schedule.
    </p>
  </div>

  <!-- Calendar View: Grid layout for the next 30 days -->
  <div class="mt-12 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
    @for(day of calendarDays(); track day.date) {
    <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-4 flex flex-col">
      <div class="text-center font-bold text-white border-b border-slate-600 pb-2 mb-3">
        <!-- Display Day of Week and Date -->
        {{ day.date | date:'EEE' }} <span class="text-slate-400 font-normal">{{ day.date | date:'MMM d' }}</span>
      </div>
      <div class="grid grid-cols-2 gap-2 flex-grow">
        @for(time of day.availableTimes; track time) {
        <button (click)="toggleSlot(day.date, time)"
          [disabled]="remainingSessions() === 0 && !isSlotSelected(day.date, time)" [ngClass]="{
                      'bg-sky-500 text-white shadow-lg shadow-sky-500/20': isSlotSelected(day.date, time),
                      'bg-slate-700 hover:bg-slate-600 text-slate-300': !isSlotSelected(day.date, time),
                      'opacity-50 cursor-not-allowed': remainingSessions() === 0 && !isSlotSelected(day.date, time)
                    }" class="text-sm font-semibold py-2 rounded-md transition-all duration-200">
          {{ time }}
        </button>
        }
        <!-- Message for days with no availability -->
        @if(day.availableTimes.length === 0) {
        <p class="col-span-2 text-center text-sm text-slate-500 my-4">No availability</p>
        }
      </div>
    </div>
    }
  </div>

  <!-- Action Buttons -->
  <div class="mt-12 flex flex-col sm:flex-row items-center justify-center gap-4">
    <button (click)="goBack.emit()"
      class="w-full sm:w-auto bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold py-3 px-8 rounded-lg transition-colors duration-300">
      Back to Plans
    </button>
    <!--               (click)="proceed.emit(selectedSlots())"
 -->
    <button (click)="goToCheckout(selectedSlots())" [disabled]="remainingSessions() !== 0" [ngClass]="{
                'bg-emerald-500 hover:bg-emerald-600 text-white cursor-pointer': remainingSessions() === 0,
                'bg-slate-600 text-slate-400 cursor-not-allowed': remainingSessions() !== 0
              }" class="w-full sm:w-auto font-semibold py-3 px-8 rounded-lg transition-colors duration-300">
      Proceed to Checkout
    </button>
  </div>
  } @else {
  <div class="text-center p-8 bg-slate-800/50 rounded-lg">
    <p class="text-lg text-slate-400">Please select a plan first to schedule your classes.</p>
  </div>
  }
</div>